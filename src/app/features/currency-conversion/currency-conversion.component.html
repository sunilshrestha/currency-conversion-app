<mat-card class="max-w-4xl mx-auto gap-y-8 mt-8">
  <mat-card-header>
    <mat-card-title class="">
      Currency Converter
    </mat-card-title>
  </mat-card-header>
  <mat-card-content>
  <form
    [formGroup]="converterForm"
    class="flex flex-col gap-4"
  >
    <div class="flex flex-col sm:flex-row items-center gap-4 sm:gap-2">
      <mat-form-field appearance="outline" floatLabel="always" hideRequiredMarker="true" class="w-full amount-form-field">
          <mat-label>Amount</mat-label>
          <input matInput formControlName="amount" mask="separator.2" thousandSeparator=",">
          @if(converterForm.controls.amount.hasError('required')){
            <mat-error>Please enter a valid amount</mat-error>
          }
          @if(converterForm.controls.amount.hasError('min')){
            <mat-error>Please enter an amount greater than 0</mat-error>
          }
      </mat-form-field>
      <mat-form-field appearance="outline" floatLabel="always" hideRequiredMarker="true" class="w-full currency-form-field">
          <mat-label>From</mat-label>
          <input type="text"
            #fromCurrency
            aria-label="From Currency"
            matInput
            formControlName="fromCurrency"
            [matAutocomplete]="fromCurrencyAuto"
            (input)="filterFromCurrencies()"
            (focus)="filterFromCurrencies(true)"
            >
          <mat-autocomplete 
            requireSelection  
            #fromCurrencyAuto="matAutocomplete"
            panelWidth="400px"
            (optionSelected)="fromCurrencySelected($event)">
            @for (option of filteredFromCurrencies; track option.code) {
              <mat-option [value]="option.code">{{option.code}} - {{option.name}}</mat-option>
            }
          </mat-autocomplete>
          @if(converterForm.controls.fromCurrency.hasError('required')){
            <mat-error>Please select a valid currency</mat-error>
          }
      </mat-form-field>
      <div class="flex justify-center mb-5">
        <button
          type="button"
          matIconButton aria-label="Swap currencies"
          (click)="swapCurrency()"
        >
          <mat-icon>
            <span class="block sm:hidden">swap_vert</span>
            <span class="hidden sm:block">swap_horiz</span>
          </mat-icon>
        </button>
      </div>
      <mat-form-field appearance="outline" floatLabel="always" hideRequiredMarker="true" class="w-full currency-form-field">
        <mat-label>To</mat-label>
        <input type="text"
            #toCurrency
            aria-label="To Currency"
            matInput
            formControlName="toCurrency"
            [matAutocomplete]="toCurrencyAuto"
            (input)="filterToCurrencies()"
            (focus)="filterToCurrencies(true)"
            >
          <mat-autocomplete 
            requireSelection 
            #toCurrencyAuto="matAutocomplete"
            panelWidth="400px"
            (optionSelected)="toCurrencySelected($event)">
            @for (option of filteredToCurrencies; track option.code) {
              <mat-option [value]="option.code">{{option.code}} - {{option.name}}</mat-option>
            }
          </mat-autocomplete>
          @if(converterForm.controls.toCurrency.hasError('required')){
            <mat-error>Please select a valid currency</mat-error>
          }
      </mat-form-field>
    </div>
    
    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-8">
      
      <div class="flex flex-col gap-2">
        @if(conversionResult(); as result) {
          <span class="flex items-center font-medium space-x-2">
            <span class="text-lg currency-info">{{result.request.amount}} {{result.request.fromCurrency}}</span>
            <span>=</span>
            <span class="text-3xl currency-amount">{{result.amount}} {{result.request.toCurrency}}</span>
          </span>
          <span class="currency-info">1 {{result.request.fromCurrency}} = {{result.meta.rate}} {{result.request.toCurrency}}</span>
          <span class="text-xs">{{result.request.fromCurrency}} to {{result.request.toCurrency}} conversion â€” Last updated {{result.meta.timestamp | date: 'dd MMM yyyy, hh:mm'}}</span>
        }
      </div>
      <div class="flex self-start justify-center sm:justify-end w-full sm:w-auto">
        <button
                matButton="tonal"
                type="button"
                (click)="convert()"
                [disabled]="converterForm.invalid"
                class="convert-button button-lg"
              >
                Convert
              </button>
      </div>
    </div>
  </form>
  </mat-card-content>
</mat-card>